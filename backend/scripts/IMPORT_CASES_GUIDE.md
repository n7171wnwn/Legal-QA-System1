# 案例数据导入指南

本指南说明如何从 `E:\Laws\Laws` 文件夹导入案例数据到数据库的 `legal_cases` 表中。

## 前置要求

1. Python 3.7+
2. MySQL 数据库已创建并运行
3. 已安装项目依赖（pymysql）

## 安装依赖

```bash
cd backend/scripts
pip install pymysql
```

或者：

```bash
pip install -r requirements.txt
```

## 使用方法

### 方法 1: 使用批处理文件（Windows，推荐）

直接双击运行 `import_cases.bat` 文件，或在命令行中执行：

```bash
cd backend/scripts
import_cases.bat
```

### 方法 2: 使用命令行

```bash
cd backend/scripts
python import_cases_data.py --repo-path E:\Laws\Laws --password hjj060618
```

### 方法 3: 指定所有参数

```bash
python import_cases_data.py \
    --repo-path E:\Laws\Laws \
    --host localhost \
    --port 3306 \
    --user root \
    --password hjj060618 \
    --database legal_qa
```

## 数据映射

脚本会自动将案例子文件夹映射到数据库中的 `law_type` 字段：

- `劳动人事` → `劳动法`
- `民法典` → `民法`
- `消费购物` → `消费者权益保护法`
- `行政协议诉讼` → `行政法`
- 其他 → `其他`

## 数据解析

脚本会解析每个案例 markdown 文件，提取以下信息：

1. **标题**：从文件第一行的 `# 标题` 或文件名提取
2. **案由**：从标题或内容中提取（包含"纠纷"、"争议"等关键词）
3. **审理法院**：从内容中提取（匹配"人民法院"、"仲裁委员会"等）
4. **判决日期**：从内容中提取日期信息
5. **核心争议点**：从"争议焦点"、"核心争议"等章节提取
6. **判决结果**：从"裁判结果"、"判决结果"等章节提取
7. **案例内容**：完整的案例内容（包括基本案情、案例分析、典型意义等）
8. **法律领域**：根据文件所在子文件夹自动确定

## 去重机制

脚本会自动检查数据库中是否已存在相同的案例（基于 `title`），如果已存在则跳过，避免重复导入。

## 导入结果

导入完成后，脚本会显示统计信息：

```
==================================================
导入完成！统计信息：
  总文件数: 57
  成功导入: 55 条案例
  跳过记录: 2 条（已存在）
  错误数量: 0
```

## 验证导入结果

导入完成后，可以通过以下方式验证：

1. **使用数据库客户端**（如 Navicat、MySQL Workbench）：

   ```sql
   SELECT COUNT(*) FROM legal_cases;
   SELECT law_type, COUNT(*) FROM legal_cases GROUP BY law_type;
   SELECT * FROM legal_cases LIMIT 10;
   ```

2. **通过前端页面**：
   - 访问知识库页面
   - 切换到"案例"标签
   - 查看导入的案例列表

3. **通过 API 接口**：

   ```bash
   curl "http://localhost:8080/api/legal/case/search?keyword=&page=0&size=10"
   ```

## 注意事项

1. **内容长度限制**：
   - `content` 字段最大 5000 字符（数据库 TEXT 类型）
   - `dispute_point` 和 `judgment_result` 字段最大 2000 字符

2. **日期格式**：
   - 脚本会尝试解析多种日期格式
   - 如果无法解析，`judge_date` 字段将为 NULL

3. **字段提取**：
   - 某些字段（如案由、法院）可能无法从所有案例中提取
   - 这些字段可以为 NULL，不影响案例的导入和显示

4. **文件格式**：
   - 脚本只处理 `.md` 文件
   - 会自动跳过 `_index.md` 文件

## 常见问题

### Q: 导入时提示"数据库连接失败"
A: 检查数据库是否运行，以及用户名、密码、数据库名是否正确。

### Q: 某些案例的字段为空
A: 这是正常的，因为不同案例的格式可能不同。脚本会尽可能提取信息，但某些字段可能无法从所有案例中提取。

### Q: 如何重新导入案例？
A: 脚本会自动跳过已存在的案例（基于标题）。如果需要重新导入，需要先删除数据库中的记录，或者修改脚本的去重逻辑。

### Q: 案例内容太长被截断
A: 数据库 `content` 字段类型为 TEXT，最大可存储约 65KB。如果案例内容超过 5000 字符，脚本会自动截断。如需存储更长的内容，需要修改数据库表结构。

## 示例

假设你的案例文件结构如下：

```
E:\Laws\Laws\案例\
  ├── 劳动人事\
  │   ├── 加班费的仲裁时效应当如何认定.md
  │   └── ...
  ├── 民法典\
  │   ├── 无偿搭乘亲友出事故 依法减轻赔偿责任.md
  │   └── ...
  └── ...
```

运行导入脚本后，这些案例会被导入到 `legal_cases` 表中，并可以通过前端页面查看。

