#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
插入知识库示例数据
"""

import pymysql
import sys
from pathlib import Path

# 数据库配置
DB_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'hjj060618',
    'database': 'legal_qa',
    'charset': 'utf8mb4'
}

# 知识库数据
KNOWLEDGE_DATA = [
    # 法条查询类
    {
        'question': '什么是《民法典》？',
        'answer': '《中华人民共和国民法典》是新中国成立以来第一部以"法典"命名的法律，是新时代我国社会主义法治建设的重大成果。民法典共7编、1260条，各编依次为总则、物权、合同、人格权、婚姻家庭、继承、侵权责任，以及附则。民法典自2021年1月1日起施行。',
        'question_type': '法条查询',
        'law_type': '民法',
        'usage_count': 15,
        'quality_score': 0.95
    },
    {
        'question': '《民法典》中关于合同的规定有哪些？',
        'answer': '《民法典》第三编合同编共分为三个分编：通则、典型合同、准合同。合同编规定了合同的订立、效力、履行、保全、变更和转让、权利义务终止、违约责任等一般规则，以及买卖合同、借款合同、租赁合同等19种典型合同。合同编强调合同自由原则，保护当事人合法权益，维护社会经济秩序。',
        'question_type': '法条查询',
        'law_type': '民法',
        'usage_count': 23,
        'quality_score': 0.92
    },
    {
        'question': '《刑法》中关于故意伤害罪的规定是什么？',
        'answer': '根据《中华人民共和国刑法》第二百三十四条规定，故意伤害他人身体的，处三年以下有期徒刑、拘役或者管制。犯前款罪，致人重伤的，处三年以上十年以下有期徒刑；致人死亡或者以特别残忍手段致人重伤造成严重残疾的，处十年以上有期徒刑、无期徒刑或者死刑。',
        'question_type': '法条查询',
        'law_type': '刑法',
        'usage_count': 18,
        'quality_score': 0.93
    },
    {
        'question': '《劳动法》中关于工作时间的规定是什么？',
        'answer': '根据《中华人民共和国劳动法》第三十六条规定，国家实行劳动者每日工作时间不超过八小时、平均每周工作时间不超过四十四小时的工时制度。第三十八条规定，用人单位应当保证劳动者每周至少休息一日。第四十一条规定，用人单位由于生产经营需要，经与工会和劳动者协商后可以延长工作时间，一般每日不得超过一小时。',
        'question_type': '法条查询',
        'law_type': '劳动法',
        'usage_count': 12,
        'quality_score': 0.90
    },
    # 概念定义类
    {
        'question': '什么是法人？',
        'answer': '法人是指具有民事权利能力和民事行为能力，依法独立享有民事权利和承担民事义务的组织。法人应当依法成立，有自己的名称、组织机构、住所、财产或者经费。法人分为营利法人、非营利法人和特别法人。营利法人包括有限责任公司、股份有限公司等企业法人；非营利法人包括事业单位、社会团体、基金会等；特别法人包括机关法人、农村集体经济组织法人等。',
        'question_type': '概念定义',
        'law_type': '民法',
        'usage_count': 28,
        'quality_score': 0.94
    },
    {
        'question': '什么是合同？',
        'answer': '合同是民事主体之间设立、变更、终止民事法律关系的协议。合同具有以下特征：1. 合同是双方或多方的法律行为；2. 合同是当事人意思表示一致的协议；3. 合同以设立、变更、终止民事权利义务关系为目的；4. 合同是合法行为。依法成立的合同，受法律保护，对当事人具有法律约束力。',
        'question_type': '概念定义',
        'law_type': '民法',
        'usage_count': 35,
        'quality_score': 0.96
    },
    {
        'question': '什么是正当防卫？',
        'answer': '正当防卫是指为了使国家、公共利益、本人或者他人的人身、财产和其他权利免受正在进行的不法侵害，而采取的制止不法侵害的行为。正当防卫不负刑事责任。正当防卫明显超过必要限度造成重大损害的，应当负刑事责任，但是应当减轻或者免除处罚。对正在进行行凶、杀人、抢劫、强奸、绑架以及其他严重危及人身安全的暴力犯罪，采取防卫行为，造成不法侵害人伤亡的，不属于防卫过当，不负刑事责任。',
        'question_type': '概念定义',
        'law_type': '刑法',
        'usage_count': 22,
        'quality_score': 0.91
    },
    {
        'question': '什么是劳动合同？',
        'answer': '劳动合同是劳动者与用人单位确立劳动关系、明确双方权利和义务的协议。建立劳动关系应当订立劳动合同。劳动合同应当以书面形式订立，并具备以下条款：1. 用人单位的名称、住所和法定代表人或者主要负责人；2. 劳动者的姓名、住址和居民身份证或者其他有效身份证件号码；3. 劳动合同期限；4. 工作内容和工作地点；5. 工作时间和休息休假；6. 劳动报酬；7. 社会保险；8. 劳动保护、劳动条件和职业危害防护等。',
        'question_type': '概念定义',
        'law_type': '劳动法',
        'usage_count': 19,
        'quality_score': 0.92
    },
    # 程序咨询类
    {
        'question': '如何申请劳动仲裁？',
        'answer': '申请劳动仲裁的程序如下：1. 准备材料：劳动仲裁申请书、身份证明、劳动关系证明、相关证据材料等；2. 确定管辖：向劳动合同履行地或者用人单位所在地的劳动争议仲裁委员会申请；3. 提交申请：在知道或者应当知道权利被侵害之日起一年内提交申请；4. 受理审查：仲裁委员会在收到申请后5日内决定是否受理；5. 开庭审理：仲裁庭在开庭5日前通知双方当事人；6. 作出裁决：仲裁庭应当自组成之日起45日内作出裁决，案情复杂可延长15日。',
        'question_type': '程序咨询',
        'law_type': '劳动法',
        'usage_count': 16,
        'quality_score': 0.89
    },
    {
        'question': '如何办理离婚手续？',
        'answer': '离婚有两种方式：1. 协议离婚：双方自愿离婚的，应当签订书面离婚协议，并亲自到婚姻登记机关申请离婚登记。离婚协议应当载明双方自愿离婚的意思表示和对子女抚养、财产以及债务处理等事项协商一致的意见。自婚姻登记机关收到离婚登记申请之日起三十日内，任何一方不愿意离婚的，可以向婚姻登记机关撤回离婚登记申请。2. 诉讼离婚：一方要求离婚的，可以直接向人民法院提起离婚诉讼。人民法院审理离婚案件，应当进行调解；如感情确已破裂，调解无效的，应当准予离婚。',
        'question_type': '程序咨询',
        'law_type': '民法',
        'usage_count': 14,
        'quality_score': 0.88
    },
    {
        'question': '如何申请法律援助？',
        'answer': '申请法律援助的程序：1. 确定是否符合条件：经济困难且案件属于法律援助范围；2. 准备材料：身份证、经济困难证明、案件相关材料等；3. 选择申请机构：向案件审理机关所在地的法律援助机构提出申请；4. 提交申请：填写法律援助申请表，提交相关材料；5. 审查决定：法律援助机构在收到申请后7个工作日内作出是否给予法律援助的决定；6. 指派律师：决定给予法律援助的，指派律师提供法律服务。',
        'question_type': '程序咨询',
        'law_type': '程序法',
        'usage_count': 11,
        'quality_score': 0.87
    },
    {
        'question': '如何申请专利？',
        'answer': '申请专利的程序：1. 准备申请文件：包括请求书、说明书、权利要求书、摘要等；2. 确定申请类型：发明、实用新型或外观设计；3. 提交申请：向国家知识产权局提交申请文件；4. 初步审查：专利局对申请进行形式审查；5. 公布申请：发明专利申请自申请日起18个月后公布；6. 实质审查：发明专利申请需要进行实质审查，实用新型和外观设计只进行初步审查；7. 授权公告：审查通过后，专利局作出授权决定并公告。',
        'question_type': '程序咨询',
        'law_type': '知识产权法',
        'usage_count': 9,
        'quality_score': 0.86
    },
    # 案例分析类
    {
        'question': '合同违约如何承担责任？',
        'answer': '合同违约责任的承担方式包括：1. 继续履行：违约方应当继续履行合同义务；2. 采取补救措施：如修理、更换、重作等；3. 赔偿损失：违约方应当赔偿因违约给对方造成的损失，包括实际损失和可得利益损失；4. 支付违约金：按照合同约定或法律规定支付违约金；5. 定金罚则：给付定金的一方不履行债务的，无权要求返还定金；收受定金的一方不履行债务的，应当双倍返还定金。当事人可以约定一方违约时应当根据违约情况向对方支付一定数额的违约金，也可以约定因违约产生的损失赔偿额的计算方法。',
        'question_type': '案例分析',
        'law_type': '民法',
        'usage_count': 27,
        'quality_score': 0.93
    },
    {
        'question': '交通事故责任如何认定？',
        'answer': '交通事故责任的认定原则：1. 过错责任原则：根据当事人的过错程度确定责任；2. 无过错责任原则：机动车与非机动车、行人发生交通事故，机动车一方即使没有过错，也要承担不超过10%的赔偿责任；3. 责任划分：全部责任、主要责任、同等责任、次要责任、无责任。公安机关交通管理部门应当根据当事人的行为对发生道路交通事故所起的作用以及过错的严重程度，确定当事人的责任。当事人对交通事故损害赔偿有争议的，可以请求公安机关交通管理部门调解，也可以直接向人民法院提起民事诉讼。',
        'question_type': '案例分析',
        'law_type': '民法',
        'usage_count': 21,
        'quality_score': 0.90
    },
    {
        'question': '劳动争议如何解决？',
        'answer': '劳动争议的解决途径：1. 协商：当事人可以自行协商解决；2. 调解：可以向劳动争议调解组织申请调解；3. 仲裁：可以向劳动争议仲裁委员会申请仲裁，这是诉讼的前置程序；4. 诉讼：对仲裁裁决不服的，可以自收到仲裁裁决书之日起15日内向人民法院提起诉讼。劳动争议申请仲裁的时效期间为一年，从当事人知道或者应当知道其权利被侵害之日起计算。因不可抗力或者有其他正当理由，当事人不能在规定的仲裁时效期间申请仲裁的，仲裁时效中止。',
        'question_type': '案例分析',
        'law_type': '劳动法',
        'usage_count': 17,
        'quality_score': 0.91
    },
    {
        'question': '知识产权侵权如何维权？',
        'answer': '知识产权侵权的维权途径：1. 行政保护：向知识产权行政管理部门投诉，请求查处侵权行为；2. 司法保护：向人民法院提起民事诉讼，要求停止侵权、赔偿损失；3. 刑事保护：对于严重侵权行为，可以向公安机关报案，追究侵权人的刑事责任。权利人应当收集和保存侵权证据，包括侵权产品、销售凭证、宣传材料等。赔偿数额可以按照实际损失、侵权获利或者许可使用费的倍数确定，难以确定的，可以请求法院在法定范围内酌定赔偿。',
        'question_type': '案例分析',
        'law_type': '知识产权法',
        'usage_count': 13,
        'quality_score': 0.88
    }
]

def insert_knowledge_data():
    """插入知识库数据"""
    try:
        # 连接数据库
        connection = pymysql.connect(**DB_CONFIG)
        cursor = connection.cursor()
        
        print(f"✓ 成功连接到数据库: {DB_CONFIG['database']}")
        
        # 检查是否已有数据
        cursor.execute("SELECT COUNT(*) FROM knowledge_base")
        existing_count = cursor.fetchone()[0]
        print(f"当前知识库已有 {existing_count} 条数据")
        
        # 插入数据
        insert_sql = """
        INSERT INTO knowledge_base (question, answer, question_type, law_type, usage_count, quality_score)
        VALUES (%s, %s, %s, %s, %s, %s)
        """
        
        inserted_count = 0
        for data in KNOWLEDGE_DATA:
            try:
                cursor.execute(insert_sql, (
                    data['question'],
                    data['answer'],
                    data['question_type'],
                    data['law_type'],
                    data['usage_count'],
                    data['quality_score']
                ))
                inserted_count += 1
            except pymysql.IntegrityError as e:
                print(f"⚠ 跳过重复数据: {data['question'][:30]}...")
            except Exception as e:
                print(f"✗ 插入失败: {data['question'][:30]}... 错误: {e}")
        
        # 提交事务
        connection.commit()
        print(f"✓ 成功插入 {inserted_count} 条知识库数据")
        
        # 查询最终数量
        cursor.execute("SELECT COUNT(*) FROM knowledge_base")
        final_count = cursor.fetchone()[0]
        print(f"✓ 知识库现在共有 {final_count} 条数据")
        
        # 关闭连接
        cursor.close()
        connection.close()
        print("✓ 数据库连接已关闭")
        
        return True
        
    except Exception as e:
        print(f"✗ 执行失败: {e}")
        return False

if __name__ == '__main__':
    print("开始插入知识库示例数据...")
    success = insert_knowledge_data()
    if success:
        print("\n✓ 数据插入完成！")
        sys.exit(0)
    else:
        print("\n✗ 数据插入失败！")
        sys.exit(1)













